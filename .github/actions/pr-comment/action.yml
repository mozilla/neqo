name: 'Comment on PR'
description: 'Post a PR comment securely.'

inputs:
  name:
    description: 'Artifact name to import comment data from.'
    required: true
  mode:
    description: 'Mode of operation (upsert/recreate/delete).'
    default: 'recreate'
  token:
    description: 'A Github PAT'
    required: true

runs:
  using: composite
  steps:
    - uses: actions/download-artifact@37930b1c2abaa49bbe596cd826c3c89aef350131 # v7.0.0
      with:
        run-id: ${{ github.event.workflow_run.id }}
        name: ${{ inputs.name }}
        github-token: ${{ inputs.token }}

    - id: pr-number
      shell: bash
      run: echo "number=$(cat pr-number)" >> "$GITHUB_OUTPUT"

    - shell: bash
      run: |
        {
          echo
          cat log-md
        } >> contents || true

    - uses: thollander/actions-comment-pull-request@24bffb9b452ba05a4f3f77933840a6a841d1b32b # v3.0.1
      with:
        file-path: contents
        mode: ${{ inputs.mode }}
        pr-number: ${{ steps.pr-number.outputs.number }}
        comment-tag: ${{ inputs.name }}-comment
