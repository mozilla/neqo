name: Fetch and build NSS

runs:
  using: composite
  steps:
    - name: Fetch and build NSS
      shell: bash
      run: |
        git clone --depth=1 https://github.com/nss-dev/nspr "$NSPR_DIR"
        git clone --depth=1 https://github.com/nss-dev/nss "$NSS_DIR"
        $NSS_DIR/build.sh -g -Ddisable_tests=1 -o
        echo "NSS_DIR=$NSS_DIR" >> "$GITHUB_ENV"
        echo "NSPR_DIR=$NSPR_DIR" >> "$GITHUB_ENV"
        echo "LD_LIBRARY_PATH=$NSS_DIR/../dist/Release/lib" >> "$GITHUB_ENV"
        echo "DYLD_FALLBACK_LIBRARY_PATH=$NSS_DIR/../dist/Release/lib" >> "$GITHUB_ENV"
        echo "$NSS_DIR/../dist/Release/lib" >> "$GITHUB_PATH"
      env:
        NSS_DIR: ${{ github.workspace }}/nss
        NSPR_DIR: ${{ github.workspace }}/nspr
